name: Commit Convention Check

on:
  push:
    tags:
      - 'v*.*.*'

jobs:
  verify-version:
    name: Verify version equality to tags

    runs-on: ubuntu-latest

    steps:
      - name: Checkout Repository
        uses: actions/checkout@v2
      - name: Get the version
        run: |
          echo "TAG_RAW=${GITHUB_REF/refs\/tags\//}" >> $GITHUB_ENV
          echo "TAG_VERSION=${GITHUB_REF/refs\/tags\/v/}" >> $GITHUB_ENV
      - name: Extract Version Properties
        id: versions
        run: |
          echo "MAVEN_PROJECT_VERSION=$(mvn org.apache.maven.plugins:maven-help-plugin:3.2.0:evaluate '-Dexpression=project.version' -q -DforceStdout)" >> $GITHUB_ENV
      - name: Check version consistency
        run: |
          if [ "${{ env.MAVEN_PROJECT_VERSION }}" != "${{ env.TAG_VERSION }}" ]; then
            >&2 echo "Tag version does not match the specified versions in Maven"
            exit 1
          fi